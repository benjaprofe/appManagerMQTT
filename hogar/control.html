<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Hogar Inteligente</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        .status.connected {
            background: #4caf50;
            color: white;
        }
        .status.disconnected {
            background: #f44336;
            color: white;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .control-card {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        .control-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .control-card h3 {
            margin-bottom: 15px;
            color: #333;
        }
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-on {
            background: #4caf50;
            color: white;
        }
        .btn-on:hover {
            background: #45a049;
        }
        .btn-off {
            background: #f44336;
            color: white;
        }
        .btn-off:hover {
            background: #da190b;
        }
        .btn-open {
            background: #2196F3;
            color: white;
        }
        .btn-close {
            background: #ff9800;
            color: white;
        }
        .slider-container {
            margin: 15px 0;
        }
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        .slider-value {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }
        .event-select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-size: 16px;
            margin-top: 10px;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
        }
        .notification.show {
            display: block;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† Panel de Control - Hogar Inteligente</h1>
        <div id="status" class="status disconnected">Desconectado</div>
        <div id="notification" class="notification"></div>
        
        <div class="controls-grid">
            <!-- Living - Luz -->
            <div class="control-card">
                <h3>üí° Living - Luz</h3>
                <button class="btn btn-on" onclick="controlLuz('on')">Encender</button>
                <button class="btn btn-off" onclick="controlLuz('off')">Apagar</button>
            </div>

            <!-- Puerta Principal -->
            <div class="control-card">
                <h3>üö™ Puerta Principal</h3>
                <button class="btn btn-open" onclick="controlPuerta('open')">Abrir</button>
                <button class="btn btn-close" onclick="controlPuerta('close')">Cerrar</button>
            </div>

            <!-- Alarma -->
            <div class="control-card">
                <h3>üö® Alarma</h3>
                <button class="btn btn-on" onclick="controlAlarma('enabled')">Activar</button>
                <button class="btn btn-off" onclick="controlAlarma('disabled')">Desactivar</button>
            </div>

            <!-- Temperatura -->
            <div class="control-card">
                <h3>üå°Ô∏è Termostato</h3>
                <div class="slider-container">
                    <input type="range" min="16" max="30" value="22" class="slider" id="tempSlider" oninput="updateTemp(this.value)">
                    <div class="slider-value" id="tempValue">22¬∞C</div>
                </div>
                <button class="btn btn-on" onclick="setTemperatura()">Establecer</button>
            </div>

            <!-- Eventos Simulados -->
            <div class="control-card">
                <h3>üéÆ Eventos Simulados</h3>
                <select class="event-select" id="eventSelect">
                    <option value="">Seleccionar evento...</option>
                    <option value="incendio">üî• Incendio</option>
                    <option value="movimiento">üë§ Movimiento Detectado</option>
                    <option value="persona_llegando">üö∂ Persona Llegando</option>
                    <option value="gas">‚õΩ Fuga de Gas</option>
                </select>
                <button class="btn btn-on" onclick="triggerEvent()" style="margin-top: 10px;">Disparar Evento</button>
            </div>

            <!-- Cocina - Luz -->
            <div class="control-card">
                <h3>üí° Cocina - Luz</h3>
                <button class="btn btn-on" onclick="controlLuzCocina('on')">Encender</button>
                <button class="btn btn-off" onclick="controlLuzCocina('off')">Apagar</button>
            </div>

            <!-- Dormitorio - Luz -->
            <div class="control-card">
                <h3>üí° Dormitorio - Luz</h3>
                <button class="btn btn-on" onclick="controlLuzDormitorio('on')">Encender</button>
                <button class="btn btn-off" onclick="controlLuzDormitorio('off')">Apagar</button>
            </div>

            <!-- TV Living -->
            <div class="control-card">
                <h3>üì∫ TV Living</h3>
                <button class="btn btn-on" onclick="controlTV('on')">Encender</button>
                <button class="btn btn-off" onclick="controlTV('off')">Apagar</button>
            </div>
        </div>
    </div>

    <script src="../env/credential.js"></script>
    <script>
        const client = createMqttClient('client_hogar');

        client.on("connect", () => {
            console.log("Panel de Control conectado!");
            document.getElementById("status").textContent = "‚úÖ Conectado";
            document.getElementById("status").className = "status connected";
            mostrarNotificacion("‚úÖ Conectado a MQTT", "success");
        });

        client.on("error", (error) => {
            console.error("Error:", error);
            document.getElementById("status").textContent = "‚ùå Error de conexi√≥n";
            document.getElementById("status").className = "status disconnected";
            mostrarNotificacion("‚ùå Error de conexi√≥n: " + error, "error");
        });

        client.on("offline", () => {
            document.getElementById("status").textContent = "‚ùå Desconectado";
            document.getElementById("status").className = "status disconnected";
            mostrarNotificacion("‚ö†Ô∏è Desconectado de MQTT", "error");
        });

        function mostrarNotificacion(mensaje, tipo = "success") {
            const notification = document.getElementById("notification");
            notification.textContent = mensaje;
            notification.className = "notification show";
            if (tipo === "error") {
                notification.style.background = "#f44336";
            } else {
                notification.style.background = "#4caf50";
            }
            setTimeout(() => {
                notification.classList.remove("show");
            }, 3000);
        }

        function publicarConConfirmacion(topic, value, descripcion) {
            if (!client.connected) {
                mostrarNotificacion("‚ùå No conectado a MQTT", "error");
                return;
            }
            
            client.publish(topic, value, { qos: 1 }, (err) => {
                if (err) {
                    console.error(`Error publicando ${topic}:`, err);
                    mostrarNotificacion(`‚ùå Error: ${descripcion}`, "error");
                } else {
                    console.log(`‚úÖ Publicado: ${topic} = ${value}`);
                    mostrarNotificacion(`‚úÖ ${descripcion}`, "success");
                }
            });
        }

        function controlLuz(state) {
            const accion = state === 'on' ? 'Encendiendo luz del living' : 'Apagando luz del living';
            publicarConConfirmacion("hogar/living/luz/set", state, accion);
        }

        function controlLuzCocina(state) {
            const accion = state === 'on' ? 'Encendiendo luz de la cocina' : 'Apagando luz de la cocina';
            publicarConConfirmacion("hogar/cocina/luz/set", state, accion);
        }

        function controlLuzDormitorio(state) {
            const accion = state === 'on' ? 'Encendiendo luz del dormitorio' : 'Apagando luz del dormitorio';
            publicarConConfirmacion("hogar/dormitorio/luz/set", state, accion);
        }

        function controlPuerta(state) {
            const accion = state === 'open' ? 'Abriendo puerta principal' : 'Cerrando puerta principal';
            publicarConConfirmacion("hogar/puerta/principal/set", state, accion);
        }

        function controlAlarma(state) {
            const accion = state === 'enabled' ? 'Activando alarma' : 'Desactivando alarma';
            publicarConConfirmacion("hogar/alarma/set", state, accion);
        }

        function updateTemp(value) {
            document.getElementById("tempValue").textContent = value + "¬∞C";
        }

        function setTemperatura() {
            const temp = document.getElementById("tempSlider").value;
            publicarConConfirmacion("hogar/clima/temperatura/set", temp, `Temperatura establecida a ${temp}¬∞C`);
        }

        function controlTV(state) {
            const accion = state === 'on' ? 'Encendiendo TV' : 'Apagando TV';
            publicarConConfirmacion("hogar/living/tv/set", state, accion);
        }

        function triggerEvent() {
            const event = document.getElementById("eventSelect").value;
            if (event) {
                const eventos = {
                    'incendio': 'üî• Simulando incendio',
                    'movimiento': 'üë§ Simulando movimiento',
                    'persona_llegando': 'üö∂ Simulando persona llegando',
                    'gas': '‚õΩ Simulando fuga de gas'
                };
                publicarConConfirmacion("hogar/evento/simulacion/set", event, eventos[event] || 'Evento disparado');
                document.getElementById("eventSelect").value = "";
            } else {
                mostrarNotificacion("‚ö†Ô∏è Selecciona un evento primero", "error");
            }
        }
    </script>
</body>
</html>

