<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Estaci√≥n Arismendi - Control de Veh√≠culos</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        .status {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 18px;
        }
        .status.connected {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4caf50;
        }
        .status.disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-top: 20px;
        }
        .vehicles-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .vehicles-panel h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        .vehicle-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .vehicle-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .vehicle-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        .vehicle-card.active {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
        }
        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .vehicle-id {
            font-weight: bold;
            font-size: 1.2em;
        }
        .vehicle-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .status-parked {
            background: #4caf50;
            color: white;
        }
        .status-in-use {
            background: #2196F3;
            color: white;
        }
        .status-maintenance {
            background: #ff9800;
            color: white;
        }
        .status-available {
            background: #9c27b0;
            color: white;
        }
        .monitoring-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .monitoring-panel h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .sensor-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #4caf50;
            transition: all 0.3s;
        }
        .sensor-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        .sensor-card.warning {
            border-left-color: #ff9800;
        }
        .sensor-card.danger {
            border-left-color: #f44336;
            animation: blink 1s infinite;
        }
        .sensor-name {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        .sensor-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
        }
        .sensor-unit {
            font-size: 0.8em;
            opacity: 0.7;
        }
        .driver-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .driver-info h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .driver-detail {
            margin: 8px 0;
            font-size: 0.95em;
        }
        .gps-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .gps-info h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .gps-coords {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .actions-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .actions-panel h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .action-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .action-status {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .action-active {
            background: #4caf50;
            color: white;
        }
        .action-inactive {
            background: #666;
            color: white;
        }
        .action-alert {
            background: #ff9800;
            color: white;
        }
        .action-danger {
            background: #f44336;
            color: white;
        }
        .parking-stats {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .logs-container {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .logs-container h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .log-entry {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .log-entry.error {
            border-left-color: #f44336;
        }
        .log-entry.warning {
            border-left-color: #ff9800;
        }
        .log-entry.success {
            border-left-color: #4caf50;
        }
        .timestamp {
            color: #aaa;
            font-size: 0.8em;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöá Estaci√≥n Arismendi - Control de Veh√≠culos</h1>
        <div id="status" class="status disconnected">Desconectado</div>
        
        <div class="main-grid">
            <!-- Panel de Veh√≠culos -->
            <div class="vehicles-panel">
                <h2>üöó Flota de Veh√≠culos</h2>
                <div class="vehicle-list" id="vehicleList">
                    <!-- Los veh√≠culos se agregar√°n din√°micamente -->
                </div>
            </div>

            <!-- Panel de Monitoreo -->
            <div class="monitoring-panel">
                <h2>üìä Monitoreo del Veh√≠culo</h2>
                <div id="selectedVehicle" style="margin-bottom: 20px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <strong>Veh√≠culo seleccionado:</strong> <span id="currentVehicle">Ninguno</span>
                </div>

                <!-- Sensores del Veh√≠culo -->
                <div class="sensor-grid">
                    <div class="sensor-card" id="battery">
                        <div class="sensor-name">üîã Bater√≠a</div>
                        <div class="sensor-value"><span id="battery-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="speed">
                        <div class="sensor-name">‚ö° Velocidad</div>
                        <div class="sensor-value"><span id="speed-value">--</span><span class="sensor-unit"> km/h</span></div>
                    </div>
                    <div class="sensor-card" id="temperature">
                        <div class="sensor-name">üå°Ô∏è Temperatura</div>
                        <div class="sensor-value"><span id="temperature-value">--</span><span class="sensor-unit">¬∞C</span></div>
                    </div>
                    <div class="sensor-card" id="humidity">
                        <div class="sensor-name">üíß Humedad</div>
                        <div class="sensor-value"><span id="humidity-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="tire-pressure">
                        <div class="sensor-name">üõû Presi√≥n Neum√°ticos</div>
                        <div class="sensor-value"><span id="tire-pressure-value">--</span><span class="sensor-unit"> PSI</span></div>
                    </div>
                    <div class="sensor-card" id="fuel">
                        <div class="sensor-name">‚õΩ Combustible</div>
                        <div class="sensor-value"><span id="fuel-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="water">
                        <div class="sensor-name">üíß Agua</div>
                        <div class="sensor-value"><span id="water-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="oil">
                        <div class="sensor-name">üõ¢Ô∏è Aceite</div>
                        <div class="sensor-value"><span id="oil-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="coolant">
                        <div class="sensor-name">‚ùÑÔ∏è Refrigerante</div>
                        <div class="sensor-value"><span id="coolant-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                    <div class="sensor-card" id="ac">
                        <div class="sensor-name">‚ùÑÔ∏è Aire Acondicionado</div>
                        <div class="sensor-value"><span id="ac-value">--</span><span class="sensor-unit">%</span></div>
                    </div>
                </div>

                <!-- Informaci√≥n del Conductor -->
                <div class="driver-info">
                    <h3>üë§ Conductor Asignado</h3>
                    <div class="driver-detail"><strong>ID:</strong> <span id="driver-id">--</span></div>
                    <div class="driver-detail"><strong>Nombre:</strong> <span id="driver-name">--</span></div>
                    <div class="driver-detail"><strong>Estado:</strong> <span id="driver-status">--</span></div>
                </div>

                <!-- Informaci√≥n GPS -->
                <div class="gps-info">
                    <h3>üìç Ubicaci√≥n GPS</h3>
                    <div class="gps-coords"><strong>Latitud:</strong> <span id="gps-lat">--</span></div>
                    <div class="gps-coords"><strong>Longitud:</strong> <span id="gps-lon">--</span></div>
                    <div class="gps-coords"><strong>Direcci√≥n:</strong> <span id="gps-address">--</span></div>
                    <div class="gps-coords"><strong>Velocidad:</strong> <span id="gps-speed">--</span> km/h</div>
                </div>

                <!-- Acciones del Sistema -->
                <div class="actions-panel">
                    <h3>‚öôÔ∏è Estado del Sistema</h3>
                    <div class="action-item">
                        <span>üõ°Ô∏è Antirrobo</span>
                        <span class="action-status action-inactive" id="antitheft-status">Inactivo</span>
                    </div>
                    <div class="action-item">
                        <span>üö® Alarma</span>
                        <span class="action-status action-inactive" id="alarm-status">Inactiva</span>
                    </div>
                    <div class="action-item">
                        <span>‚ö†Ô∏è Alerta</span>
                        <span class="action-status action-inactive" id="alert-status">Inactiva</span>
                    </div>
                    <div class="action-item">
                        <span>üÜò Emergencia</span>
                        <span class="action-status action-inactive" id="emergency-status">Inactiva</span>
                    </div>
                    <div class="action-item">
                        <span>üîí Seguridad</span>
                        <span class="action-status action-inactive" id="security-status">Inactiva</span>
                    </div>
                    <div class="action-item">
                        <span>üéÆ Control</span>
                        <span class="action-status action-inactive" id="control-status">Inactivo</span>
                    </div>
                    <div class="action-item">
                        <span>üì° Monitoreo</span>
                        <span class="action-status action-active" id="monitoring-status">Activo</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas de Estacionamiento -->
        <div class="parking-stats">
            <h2>üìà Estad√≠sticas de Estacionamiento</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Veh√≠culos</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Estacionados</div>
                    <div class="stat-value" id="stat-parked">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">En Uso</div>
                    <div class="stat-value" id="stat-in-use">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Disponibles</div>
                    <div class="stat-value" id="stat-available">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">En Mantenimiento</div>
                    <div class="stat-value" id="stat-maintenance">0</div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="logs-container">
            <h3>üìù Logs de Eventos en Tiempo Real</h3>
            <div id="logs"></div>
        </div>
    </div>

    <script src="../env/credential.js"></script>
    <script>
        const client = createMqttClient('client_arismendi');

        const vehicles = {};
        let selectedVehicleId = null;
        const stats = {
            total: 0,
            parked: 0,
            inUse: 0,
            available: 0,
            maintenance: 0
        };

        client.on("connect", () => {
            console.log("Dashboard Arismendi conectado!");
            document.getElementById("status").textContent = "‚úÖ Conectado";
            document.getElementById("status").className = "status connected";
            
            const topics = [
                "arismendi/vehiculo/+/state",
                "arismendi/vehiculo/+/bateria",
                "arismendi/vehiculo/+/velocidad",
                "arismendi/vehiculo/+/temperatura",
                "arismendi/vehiculo/+/humedad",
                "arismendi/vehiculo/+/neumaticos/presion",
                "arismendi/vehiculo/+/combustible",
                "arismendi/vehiculo/+/agua",
                "arismendi/vehiculo/+/aceite",
                "arismendi/vehiculo/+/refrigerante",
                "arismendi/vehiculo/+/ac",
                "arismendi/vehiculo/+/conductor",
                "arismendi/vehiculo/+/gps",
                "arismendi/vehiculo/+/antirrobo",
                "arismendi/vehiculo/+/alarma",
                "arismendi/vehiculo/+/alerta",
                "arismendi/vehiculo/+/emergencia",
                "arismendi/vehiculo/+/seguridad",
                "arismendi/estacionamiento/entrada",
                "arismendi/estacionamiento/salida",
                "arismendi/estacionamiento/entrega"
            ];
            
            topics.forEach((topic, index) => {
                setTimeout(() => {
                    client.subscribe(topic, { qos: 1 }, (err, granted) => {
                        if (err) {
                            console.error(`‚ùå Error suscribi√©ndose a ${topic}:`, err);
                            addLog(`‚ùå Error: ${topic}`, "error");
                        } else {
                            console.log(`‚úÖ Suscrito a: ${topic}`);
                            addLog(`‚úÖ Suscrito: ${topic}`, "success");
                        }
                    });
                }, index * 100);
            });
            
            setTimeout(() => {
                client.subscribe("arismendi/#", { qos: 1 }, (err) => {
                    if (!err) {
                        console.log("‚úÖ Suscrito a wildcard: arismendi/#");
                        addLog("‚úÖ Wildcard: arismendi/#", "success");
                    }
                });
            }, topics.length * 100 + 200);
        });

        client.on("error", (error) => {
            console.error("Error:", error);
            document.getElementById("status").textContent = "‚ùå Error de conexi√≥n";
            document.getElementById("status").className = "status disconnected";
            addLog("Error de conexi√≥n: " + error, "error");
        });

        client.on("offline", () => {
            console.log("Cliente desconectado");
            document.getElementById("status").textContent = "‚ùå Desconectado";
            document.getElementById("status").className = "status disconnected";
            addLog("‚ö†Ô∏è Desconectado de MQTT", "warning");
        });

        client.on("reconnect", () => {
            console.log("Reconectando...");
            document.getElementById("status").textContent = "üîÑ Reconectando...";
            addLog("üîÑ Intentando reconectar...", "warning");
        });

        client.on("message", (topic, message) => {
            const msg = message.toString();
            console.log(`üì® Mensaje recibido: ${topic} = ${msg}`);
            
            try {
                updateData(topic, msg);
                addLog(`${topic}: ${msg}`, "info");
            } catch (error) {
                console.error(`‚ùå Error procesando mensaje:`, error);
                addLog(`‚ùå Error: ${error.message}`, "error");
            }
        });

        function updateData(topic, value) {
            // Extraer ID del veh√≠culo del topic
            const parts = topic.split('/');
            const vehicleId = parts[2] || 'unknown';
            
            // Inicializar veh√≠culo si no existe
            if (!vehicles[vehicleId]) {
                vehicles[vehicleId] = {
                    id: vehicleId,
                    status: 'available',
                    conductor: null,
                    gps: null
                };
                renderVehicles();
                updateStats();
            }

            // Actualizar datos seg√∫n el topic
            if (topic.includes('/state')) {
                vehicles[vehicleId].status = value;
                renderVehicles();
                updateStats();
            } else if (topic.includes('/bateria')) {
                updateSensor('battery', parseFloat(value));
            } else if (topic.includes('/velocidad')) {
                updateSensor('speed', parseFloat(value));
            } else if (topic.includes('/temperatura')) {
                updateSensor('temperature', parseFloat(value));
            } else if (topic.includes('/humedad')) {
                updateSensor('humidity', parseFloat(value));
            } else if (topic.includes('/neumaticos/presion')) {
                updateSensor('tire-pressure', parseFloat(value));
            } else if (topic.includes('/combustible')) {
                updateSensor('fuel', parseFloat(value));
            } else if (topic.includes('/agua')) {
                updateSensor('water', parseFloat(value));
            } else if (topic.includes('/aceite')) {
                updateSensor('oil', parseFloat(value));
            } else if (topic.includes('/refrigerante')) {
                updateSensor('coolant', parseFloat(value));
            } else if (topic.includes('/ac')) {
                updateSensor('ac', parseFloat(value));
            } else if (topic.includes('/conductor')) {
                try {
                    const conductor = JSON.parse(value);
                    vehicles[vehicleId].conductor = conductor;
                    if (selectedVehicleId === vehicleId) {
                        updateDriverInfo(conductor);
                    }
                } catch (e) {
                    vehicles[vehicleId].conductor = { id: value, name: 'Conductor' };
                    if (selectedVehicleId === vehicleId) {
                        updateDriverInfo(vehicles[vehicleId].conductor);
                    }
                }
            } else if (topic.includes('/gps')) {
                try {
                    const gps = JSON.parse(value);
                    vehicles[vehicleId].gps = gps;
                    if (selectedVehicleId === vehicleId) {
                        updateGPSInfo(gps);
                    }
                } catch (e) {
                    const coords = value.split(',');
                    vehicles[vehicleId].gps = { lat: coords[0], lon: coords[1] };
                    if (selectedVehicleId === vehicleId) {
                        updateGPSInfo(vehicles[vehicleId].gps);
                    }
                }
            } else if (topic.includes('/antirrobo')) {
                updateAction('antitheft', value);
            } else if (topic.includes('/alarma')) {
                updateAction('alarm', value);
            } else if (topic.includes('/alerta')) {
                updateAction('alert', value);
            } else if (topic.includes('/emergencia')) {
                updateAction('emergency', value);
            } else if (topic.includes('/seguridad')) {
                updateAction('security', value);
            } else if (topic.includes('/control')) {
                updateAction('control', value);
            } else if (topic.includes('/monitoreo')) {
                updateAction('monitoring', value);
            }
        }

        function updateSensor(sensorId, value) {
            if (isNaN(value)) return;
            
            const valueEl = document.getElementById(`${sensorId}-value`);
            const card = document.getElementById(sensorId);
            
            if (!valueEl || !card) return;
            
            valueEl.textContent = value.toFixed(1);
            
            // Aplicar alertas seg√∫n el sensor
            card.classList.remove('warning', 'danger');
            
            if (sensorId === 'battery' && value < 20) {
                card.classList.add('danger');
            } else if (sensorId === 'battery' && value < 40) {
                card.classList.add('warning');
            } else if (sensorId === 'fuel' && value < 15) {
                card.classList.add('danger');
            } else if (sensorId === 'fuel' && value < 30) {
                card.classList.add('warning');
            } else if (sensorId === 'oil' && value < 20) {
                card.classList.add('danger');
            } else if (sensorId === 'oil' && value < 40) {
                card.classList.add('warning');
            } else if (sensorId === 'water' && value < 20) {
                card.classList.add('danger');
            } else if (sensorId === 'water' && value < 40) {
                card.classList.add('warning');
            } else if (sensorId === 'coolant' && value < 20) {
                card.classList.add('danger');
            } else if (sensorId === 'coolant' && value < 40) {
                card.classList.add('warning');
            } else if (sensorId === 'tire-pressure' && (value < 25 || value > 40)) {
                card.classList.add('warning');
            } else if (sensorId === 'temperature' && (value < 0 || value > 100)) {
                card.classList.add('danger');
            } else if (sensorId === 'temperature' && (value < 10 || value > 80)) {
                card.classList.add('warning');
            }
        }

        function updateDriverInfo(conductor) {
            document.getElementById('driver-id').textContent = conductor.id || '--';
            document.getElementById('driver-name').textContent = conductor.name || '--';
            document.getElementById('driver-status').textContent = conductor.status || 'Asignado';
        }

        function updateGPSInfo(gps) {
            document.getElementById('gps-lat').textContent = gps.lat || '--';
            document.getElementById('gps-lon').textContent = gps.lon || '--';
            document.getElementById('gps-address').textContent = gps.address || '--';
            document.getElementById('gps-speed').textContent = gps.speed || '0';
        }

        function updateAction(actionId, state) {
            const statusEl = document.getElementById(`${actionId}-status`);
            if (!statusEl) return;
            
            const stateLower = String(state).toLowerCase().trim();
            
            if (stateLower === 'on' || stateLower === 'active' || stateLower === '1' || stateLower === 'true') {
                statusEl.textContent = 'Activo';
                statusEl.className = `action-status action-active`;
            } else if (stateLower === 'alert' || stateLower === 'warning') {
                statusEl.textContent = 'Alerta';
                statusEl.className = `action-status action-alert`;
            } else if (stateLower === 'danger' || stateLower === 'emergency') {
                statusEl.textContent = 'Peligro';
                statusEl.className = `action-status action-danger`;
            } else {
                statusEl.textContent = 'Inactivo';
                statusEl.className = `action-status action-inactive`;
            }
        }

        function renderVehicles() {
            const list = document.getElementById('vehicleList');
            list.innerHTML = '';
            
            Object.values(vehicles).forEach(vehicle => {
                const card = document.createElement('div');
                card.className = `vehicle-card ${selectedVehicleId === vehicle.id ? 'active' : ''}`;
                card.onclick = () => selectVehicle(vehicle.id);
                
                const statusClass = `status-${vehicle.status}`;
                const statusText = {
                    'parked': 'Estacionado',
                    'in-use': 'En Uso',
                    'maintenance': 'Mantenimiento',
                    'available': 'Disponible'
                };
                
                card.innerHTML = `
                    <div class="vehicle-header">
                        <span class="vehicle-id">üöó ${vehicle.id}</span>
                        <span class="vehicle-status ${statusClass}">${statusText[vehicle.status] || vehicle.status}</span>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${vehicle.conductor ? `Conductor: ${vehicle.conductor.name || vehicle.conductor.id}` : 'Sin conductor'}
                    </div>
                `;
                
                list.appendChild(card);
            });
        }

        function selectVehicle(vehicleId) {
            selectedVehicleId = vehicleId;
            document.getElementById('currentVehicle').textContent = vehicleId;
            renderVehicles();
            
            const vehicle = vehicles[vehicleId];
            if (vehicle) {
                if (vehicle.conductor) {
                    updateDriverInfo(vehicle.conductor);
                }
                if (vehicle.gps) {
                    updateGPSInfo(vehicle.gps);
                }
            }
            
            addLog(`üìå Veh√≠culo ${vehicleId} seleccionado`, "info");
        }

        function updateStats() {
            stats.total = Object.keys(vehicles).length;
            stats.parked = Object.values(vehicles).filter(v => v.status === 'parked').length;
            stats.inUse = Object.values(vehicles).filter(v => v.status === 'in-use').length;
            stats.available = Object.values(vehicles).filter(v => v.status === 'available').length;
            stats.maintenance = Object.values(vehicles).filter(v => v.status === 'maintenance').length;
            
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-parked').textContent = stats.parked;
            document.getElementById('stat-in-use').textContent = stats.inUse;
            document.getElementById('stat-available').textContent = stats.available;
            document.getElementById('stat-maintenance').textContent = stats.maintenance;
        }

        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById("logs");
            const logEntry = document.createElement("div");
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            logsContainer.insertBefore(logEntry, logsContainer.firstChild);
            
            while (logsContainer.children.length > 50) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }
    </script>
</body>
</html>

